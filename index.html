<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hitung Visual - WKB</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- jsPDF + html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-in': 'bounceIn 0.6s ease-out'
                    }
                }
            }
        }
    </script>
    
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen">
    <div x-data="hitungVisual()" x-init="init()" class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl mb-8 overflow-hidden" data-aos="fade-down">
            <div class="bg-gradient-to-r from-cyan-400 to-blue-500 p-8 text-center text-white">
                <h1 class="text-4xl md:text-5xl font-bold mb-3 animate-bounce-in">üöõ HITUNG VISUAL</h1>
                <p class="text-lg md:text-xl opacity-90"> by PPIC WKB</p>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="space-y-6" data-aos="fade-right">
                <!-- Container Settings -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                    <button @click="containerVisible = !containerVisible" 
                            class="flex items-center justify-between w-full text-left">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center gap-3">
                        Dimensi Container
                        </h2>
                        <span class="text-gray-500 transform transition-transform duration-300"
                              :class="containerVisible ? 'rotate-90' : ''">‚ñ∂</span>
                    </button>
                    
                    <div x-show="containerVisible" x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 transform -translate-y-2"
                         x-transition:enter-end="opacity-100 transform translate-y-0"
                         class="mt-4 space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Lebar (cm)</label>
                                <input type="number" x-model.number="container.width" @input="updateVisualization"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Tinggi (cm)</label>
                                <input type="number" x-model.number="container.height" @input="updateVisualization"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mode Selection -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-3">üì¶ Mode Penataan</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="mode = 'rows'; updateVisualization()" 
                                :class="mode === 'rows' ? 'bg-blue-500 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                class="py-3 px-6 rounded-xl font-semibold transition-all duration-200 transform hover:scale-105">
                            Keatas
                        </button>
                        <button @click="mode = 'columns'; updateVisualization()" 
                                :class="mode === 'columns' ? 'bg-blue-500 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                class="py-3 px-6 rounded-xl font-semibold transition-all duration-200 transform hover:scale-105">
                            Kesamping
                        </button>
                    </div>
                </div>

                <!-- Box Input -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-3">üí° Input Penataan</h3>
                    
                    <!-- Header -->
                    <div class="grid grid-cols-5 gap-2 mb-4 text-sm font-semibold text-gray-600 bg-gray-50 p-3 rounded-lg">
                        <div class="text-center">No.</div>
                        <div class="text-center">Jumlah</div>
                        <div class="text-center">Lebar</div>
                        <div class="text-center">Tinggi</div>
                        <div class="text-center">Aksi</div>
                    </div>
                    
                    <!-- Box Rows -->
                    <div class="space-y-3 max-h-80 overflow-y-auto">
                        <template x-for="(box, index) in boxes" :key="index">
                            <div class="grid grid-cols-5 gap-2 items-center bg-gradient-to-r from-blue-50 to-indigo-50 p-3 rounded-lg animate-slide-up">
                                <div class="text-center font-semibold text-gray-700" x-text="index + 1"></div>
                                <input type="number" x-model.number="box.count" @input="updateVisualization" min="1"
                                       class="px-3 py-2 border border-gray-300 rounded-lg text-center focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all">
                                <input type="number" x-model.number="box.width" @input="updateVisualization" min="1"
                                       class="px-3 py-2 border border-gray-300 rounded-lg text-center focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all">
                                <input type="number" x-model.number="box.height" @input="updateVisualization" min="1"
                                       class="px-3 py-2 border border-gray-300 rounded-lg text-center focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all">
                                <button @click="removeBox(index)" x-show="boxes.length > 1"
                                        class="bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center mx-auto transition-all duration-200 transform hover:scale-110">
                                    √ó
                                </button>
                            </div>
                        </template>
                    </div>
                    
                    <button @click="addBox()" 
                            class="w-full mt-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                        + Tambah Baris
                    </button>
                </div>
            </div>

            <!-- Visualization Section -->
            <div class="space-y-6" data-aos="fade-left">
                <!-- Canvas -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-3">Ô∏èüì¶ Visualisasi Layout</h2>
                    <div class="bg-gray-50 rounded-xl p-4 text-center">
                        <svg id="visualCanvas" class="mx-auto border-2 border-gray-300 rounded-lg shadow-inner" 
                             width="400" height="400" viewBox="0 0 400 400">
                        </svg>
                    </div>
                </div>

                <!-- Summary -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6" id="summarySection">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-3">üìä Ringkasan Hasil</h3>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center py-3 border-b border-gray-200">
                            <span class="font-semibold text-gray-700">Total MC:</span>
                            <span class="text-xl font-bold text-blue-600" x-text="summary.totalBoxes"></span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-gray-200">
                            <span class="font-semibold text-gray-700">Area Terpakai:</span>
                            <span class="text-xl font-bold text-green-600" x-text="summary.usedArea + ' cm¬≤'"></span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-gray-200">
                            <span class="font-semibold text-gray-700">Area Container:</span>
                            <span class="text-xl font-bold text-purple-600" x-text="summary.totalArea + ' cm¬≤'"></span>
                        </div>
                        
                        <!-- Efficiency -->
                        <div class="bg-gradient-to-r from-emerald-400 to-cyan-400 rounded-xl p-6 text-center text-white">
                            <div class="text-lg font-semibold mb-2">Efisiensi Ruang</div>
                            <div class="text-4xl font-bold" x-text="summary.efficiency + '%'"></div>
                        </div>
                        
                        <!-- Warning -->
                        <div x-show="summary.warning" x-transition
                             class="bg-red-500 text-white p-4 rounded-xl text-center font-semibold">
                            ‚ö†Ô∏è Ukuran total melebihi batas Container!
                        </div>
                    </div>
                    
                    <button @click="exportToPDF()" 
                            class="w-full mt-6 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                        üì§ Export ke PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function hitungVisual() {
            return {
                container: {
                    width: 229,
                    height: 253
                },
                mode: 'rows',
                containerVisible: false,
                boxes: [
                    { count: 3, width: 70, height: 50 },
                    { count: 5, width: 45, height: 40 }
                ],
                summary: {
                    totalBoxes: 0,
                    usedArea: 0,
                    totalArea: 0,
                    efficiency: 0,
                    warning: false
                },
                colors: ['#ef4444', '#06b6d4', '#3b82f6', '#10b981', '#f59e0b', '#ec4899', '#8b5cf6', '#6366f1'],

                init() {
                    AOS.init({
                        duration: 800,
                        easing: 'ease-in-out',
                        once: true
                    });
                    this.updateVisualization();
                },

                addBox() {
                    this.boxes.push({ count: 1, width: 50, height: 40 });
                    this.updateVisualization();
                },

                removeBox(index) {
                    if (this.boxes.length > 1) {
                        this.boxes.splice(index, 1);
                        this.updateVisualization();
                    }
                },

                updateVisualization() {
                    this.calculateSummary();
                    this.drawVisualization();
                },

                calculateSummary() {
                    let totalBoxes = 0;
                    let usedArea = 0;
                    let maxWidth = 0;
                    let totalHeight = 0;

                    this.boxes.forEach(box => {
                        totalBoxes += box.count;
                        usedArea += box.count * box.width * box.height;
                        
                        if (this.mode === 'rows') {
                            maxWidth = Math.max(maxWidth, box.count * box.width);
                            totalHeight += box.height;
                        } else {
                            maxWidth += box.width;
                            totalHeight = Math.max(totalHeight, box.count * box.height);
                        }
                    });

                    const totalArea = this.container.width * this.container.height;
                    const efficiency = ((usedArea / totalArea) * 100).toFixed(1);

                    this.summary = {
                        totalBoxes: totalBoxes.toLocaleString(),
                        usedArea: usedArea.toLocaleString(),
                        totalArea: totalArea.toLocaleString(),
                        efficiency: efficiency,
                        warning: maxWidth > this.container.width || totalHeight > this.container.height
                    };
                },

                drawVisualization() {
                    const svg = document.getElementById('visualCanvas');
                    const scale = Math.min(380 / this.container.width, 380 / this.container.height);
                    const scaledWidth = this.container.width * scale;
                    const scaledHeight = this.container.height * scale;

                    svg.setAttribute('viewBox', `0 0 ${scaledWidth + 20} ${scaledHeight + 20}`);
                    svg.innerHTML = '';

                    // Container outline
                    const containerRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    containerRect.setAttribute('x', 10);
                    containerRect.setAttribute('y', 10);
                    containerRect.setAttribute('width', scaledWidth);
                    containerRect.setAttribute('height', scaledHeight);
                    containerRect.setAttribute('fill', 'none');
                    containerRect.setAttribute('stroke', '#374151');
                    containerRect.setAttribute('stroke-width', 3);
                    containerRect.setAttribute('rx', 8);
                    svg.appendChild(containerRect);

                    // Draw boxes
                    let currentY = 10;
                    let currentX = 10;

                    this.boxes.forEach((box, boxIndex) => {
                        const color = this.colors[boxIndex % this.colors.length];
                        
                        if (this.mode === 'rows') {
                            currentX = 10;
                            for (let i = 0; i < box.count; i++) {
                                this.createBox(svg, currentX, scaledHeight + 10 - currentY - (box.height * scale), 
                                             box.width * scale, box.height * scale, color, box);
                                currentX += box.width * scale;
                            }
                            currentY += box.height * scale;
                        } else {
                            let columnY = scaledHeight + 10;
                            for (let i = 0; i < box.count; i++) {
                                columnY -= box.height * scale;
                                this.createBox(svg, currentX, columnY, 
                                             box.width * scale, box.height * scale, color, box);
                            }
                            currentX += box.width * scale;
                        }
                    });
                },

                createBox(svg, x, y, width, height, color, box) {
                    // Box with gradient and shadow
                    const defs = svg.querySelector('defs') || svg.appendChild(document.createElementNS('http://www.w3.org/2000/svg', 'defs'));
                    
                    const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
                    const gradientId = `gradient-${Math.random().toString(36).substr(2, 9)}`;
                    gradient.setAttribute('id', gradientId);
                    gradient.innerHTML = `
                        <stop offset="0%" style="stop-color:${color};stop-opacity:1" />
                        <stop offset="100%" style="stop-color:${color};stop-opacity:0.7" />
                    `;
                    defs.appendChild(gradient);

                    const boxRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    boxRect.setAttribute('x', x);
                    boxRect.setAttribute('y', y);
                    boxRect.setAttribute('width', width);
                    boxRect.setAttribute('height', height);
                    boxRect.setAttribute('fill', `url(#${gradientId})`);
                    boxRect.setAttribute('stroke', '#ffffff');
                    boxRect.setAttribute('stroke-width', 2);
                    boxRect.setAttribute('rx', 4);
                    boxRect.setAttribute('filter', 'drop-shadow(2px 2px 4px rgba(0,0,0,0.2))');
                    svg.appendChild(boxRect);

                    // Text label
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', x + width / 2);
                    text.setAttribute('y', y + height / 2);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('dominant-baseline', 'middle');
                    text.setAttribute('fill', '#ffffff');
                    text.setAttribute('font-size', Math.min(14, Math.min(width / 6, height / 3)));
                    text.setAttribute('font-weight', 'bold');
                    text.setAttribute('font-family', 'system-ui, sans-serif');
                    text.textContent = `${box.width}√ó${box.height}`;
                    svg.appendChild(text);
                },

                async exportToPDF() {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                    // Title
                    doc.setFontSize(24);
                    doc.setFont(undefined, 'bold');
                    doc.text('üì¶ HITUNG VISUAL', 20, 30);
                    
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'normal');
                    doc.text('Layout Penataan MC Custom', 20, 45);

                    // Container info
                    doc.setFontSize(12);
                    doc.text(`Ukuran Container: ${this.container.width} cm √ó ${this.container.height} cm`, 20, 65);
                    doc.text(`Mode Penataan: ${this.mode === 'rows' ? 'Keatas' : 'Kesamping'}`, 20, 75);

                    // Box details
                    let yPos = 95;
                    doc.setFont(undefined, 'bold');
                    doc.text('Detail Penataan:', 20, yPos);
                    yPos += 10;

                    doc.setFont(undefined, 'normal');
                    this.boxes.forEach((box, index) => {
                        doc.text(`${this.mode === 'rows' ? 'Baris' : 'Kolom'} ${index + 1}: ${box.count} kotak @ ${box.width} √ó ${box.height} cm`, 20, yPos);
                        yPos += 10;
                    });

                    // Summary
                    yPos += 10;
                    doc.setFont(undefined, 'bold');
                    doc.text('Ringkasan Hasil:', 20, yPos);
                    yPos += 10;

                    doc.setFont(undefined, 'normal');
                    doc.text(`Total MC: ${this.summary.totalBoxes}`, 20, yPos);
                    yPos += 10;
                    doc.text(`Area Terpakai: ${this.summary.usedArea} cm¬≤`, 20, yPos);
                    yPos += 10;
                    doc.text(`Area Container: ${this.summary.totalArea} cm¬≤`, 20, yPos);
                    yPos += 10;
                    doc.text(`Efisiensi: ${this.summary.efficiency}%`, 20, yPos);

                    // Capture visualization
                    try {
                        const canvas = await html2canvas(document.getElementById('visualCanvas'));
                        const imgData = canvas.toDataURL('image/png');
                        doc.addImage(imgData, 'PNG', 20, yPos + 20, 160, 120);
                    } catch (error) {
                        console.log('Could not capture visualization');
                    }

                    // Export date
                    const now = new Date();
                    doc.text(`Exported: ${now.toLocaleDateString('id-ID')}`, 20, 280);

                    doc.save('hitung-visual-WKB.pdf');
                }
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96b789e3352f9b07',t:'MTc1NDU3NzcyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
